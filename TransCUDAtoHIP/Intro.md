# Translating CUDA to HIP

## What is CUDA?

CUDA stands for Compute Unified Device Architecture, and is a parallel computing platform and application programming interface model created by Nvidia. It is used for programming CUDA-enabled GPUs, which are mostly Nvidia GPUs. CUDA is the software layer that allows a programmer to access many of the GPU's features, such as its virtual instruction set and parallel computing.

CUDA works with many programming languages, such as C, C++, and Fortran. CUDA-enabled GPUs also support frameworks like OpenCL and OpenACC.


## Why port CUDA to HIP?
Software written to optimize a GPU tends to be done in CUDA, which unfortunately allows that software to only running on hardware supported by CUDA. HIP, on the other hand, can be used and compiled for both the Nvidia and AMD hardware environments, making it more versatile.

Because HIP allows a GPU programmer to avoid being locked into graphics cards produced by certain companies, it can remove the downsides of programming in CUDA. HIP is becoming a favorite among high performance computing programming. However, what can one do about code they have previously written in CUDA? What about the massive amounts of legacy CUDA code available online? Would porting this code to HIP be worthwhile?

If a programmer had to port all of this CUDA code manually, it would likely take more work than it is worth. Thankfully, the ROCm developers included two automated methods for converting CUDA projects to HIP in the ROCm environment, making the transition for programmers simple.

## Tools to port CUDA to HIP
- hipify-clang
    - a clang-based tool for translation CUDA sources into HIP sources. It translates CUDA source into an abstract syntax tree, which is being traversed by transformation matchers. After applying all the matchers, the output HIP source is produced.
- hipify-perl
    - an autogenerated perl-based script which heavily uses regular expressions.

Both tools offer advantages and disadvantages.

The `hipify-perl` script does not check the input source CUDA code for correctness, and does not depend on any third party tools, including CUDA. However, it does have a few constructs it cannot transform correctly, including macros expansion, namespaces, and device/host funciton calls distinguishing.

The `hipify-clang` tool is a real translator, meaning even very complicated constructs will be correctly translated (unless an error occurs). It also supports clang options such as `-I` and `-D`, and features seamless support of new CUDA versions (as it depends on clang). The big disadvantages when compared to hipify-perl, however, is that incorrect input CUDA code won't be translated to HIP and CUDA must be installed (as the tool depends on this installation).

## Installation
Follow the [installation guide](https://rocmdocs.amd.com/en/latest/Installation_Guide/Installation-Guide.html#hip-installation-instructions), and then [verify your installation](https://rocmdocs.amd.com/en/latest/Installation_Guide/Installation-Guide.html#verify-your-installation).

## Porting CUDA to HIP
### Hipify-clang
To process a file, `hipify-clang` needs access to all the headers that would be required to compile that file with clang. For example:

```./hipify-clang square.cu --cuda-path=/usr/local/cuda-11.0 -I /usr/local/cuda-11.0/samples/common/inc```

To use `hipify-clang`, arguments are input first, followed by the separator `--`, and then arguments that would be passed to `clang` if you were compiling that file. For example:

```./hipify-clang cpp17.cu --cuda-path=/usr/local/cuda-11.0 -- -std=c++17```

For a list of `hipify-clang` options, use `hipify-clang --help`.

For more information on `hipify-clang` and its usage, see [the Clang manual for compiling CUDA](https://llvm.org/docs/CompileCudaWithLLVM.html#compiling-cuda-code).

### Hipify-perl
The `hipify-perl` script comes with [the ROCm installation](../IntroToRocm/Intro.md) and is located in the HIP/Bin directory. It is also possible to produce `hipify-perl` script using the `hipify-clang` compiler by using the command `hipify-clang --perl`.

To convert the CUDA file foo.cu to HIP format, use the following:

```hipify-perl foo.cu > translated.cpp```

The resulting HIP-ready .cpp file can then be compiled for the ROCm environment with the HIP/Clang compiler, using:

```hipcc translated.cpp```


## Practice Problems / Questions
[Review questions on this topic](Practice/Questions.md)
[Practice](Practice/Examples.md)

## Resources / References
- [HIPIFY GitHub Repo](https://github.com/ROCm-Developer-Tools/HIPIFY)
- [ADMIN Magazine's Article "Porting CUDA to HIP"](https://www.admin-magazine.com/HPC/Articles/Porting-CUDA-to-HIP)
- [Compiling CUDA Code from LLVM](https://llvm.org/docs/CompileCudaWithLLVM.html#compiling-cuda-code)

